# Phase 09.1: Multi-Site Support - Context

**Gathered:** 2026-02-16
**Status:** Ready for planning

<domain>
## Phase Boundary

Toggle between multiple site connections in the top bar. Users can switch the active site, see connection status, and add new sites without leaving the plugin. This phase does NOT add new site capabilities — it makes existing single-site features work across multiple connections.

</domain>

<decisions>
## Implementation Decisions

### Site switcher UX
- Top bar shows current site name with a colored dot indicator (green=connected, red=disconnected)
- Clicking the site name opens a command palette (Cmd+K style) filtered to connected sites
- Each entry in the palette shows: site name (derived from folder), project path, and connection status
- Switcher is always visible, even with only one site (palette can show "Add site" option)
- "+" button next to the site selector in the top bar as a second entry point for adding sites
- "Add site" option also available inside the command palette — both open the inline wizard (Phase 6 flow)

### State on switch
- If there are unsaved changes in the current editor, show a confirmation dialog before switching
- On switch, navigate to the new site's pages list (clean slate, not same route)
- Preview iframe reloads immediately with the new site's tunnel URL
- Each site's scanned blocks and loaders are cached independently (React Query keyed per site)
- Switching back to a previously visited site shows cached data instantly

### Connection lifecycle
- Adding new sites: from command palette ("Add site" option) or "+" button in top bar — both open Phase 6 inline wizard
- Removing/disconnecting sites: only through project settings (not from palette — destructive action stays in settings)
- Disconnected sites appear greyed out with "disconnected" label in the palette — still selectable (user sees Phase 9 reconnect overlay)
- No limit on number of site connections

### Default & memory
- On startup, restore the last active site (remember which site the user was on)
- Last active site preference stored in browser localStorage (per-user, no server round-trip)
- Site display name auto-derived from project folder name (e.g., "anjo.chat") — not user-editable
- If last active site is disconnected on startup, show it anyway (user sees reconnect overlay)

### Claude's Discretion
- Command palette implementation details (reuse existing palette component or build new)
- Exact dot indicator styling and positioning
- localStorage key naming and structure
- React Query key namespacing strategy for per-site caching
- Transition animations between sites

</decisions>

<specifics>
## Specific Ideas

- The command palette approach combines both the compact top-bar selector and the searchable list — click the site name to open it
- Two entry points for adding sites (top bar "+" and palette "Add site") ensure discoverability
- Greyed-out disconnected sites leverage the existing Phase 9 reconnect overlay — no new disconnected state UI needed

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 09.1-multi-site-support*
*Context gathered: 2026-02-16*
