---
phase: 17-site-editor-plugin
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mesh-plugin-site-editor/package.json
  - packages/mesh-plugin-site-editor/tsconfig.json
  - packages/mesh-plugin-site-editor/shared.ts
  - packages/mesh-plugin-site-editor/client/index.tsx
  - packages/mesh-plugin-site-editor/client/components/plugin-header.tsx
  - packages/mesh-plugin-site-editor/client/components/plugin-empty-state.tsx
  - packages/mesh-plugin-site-editor/server/index.ts
autonomous: true
requirements:
  - EDT-15

must_haves:
  truths:
    - "packages/mesh-plugin-site-editor/ exists as a valid Bun workspace package"
    - "The package exports ./client and ./server entry points"
    - "clientPlugin is a valid ClientPlugin<typeof DECO_BLOCKS_BINDING> with id='site-editor', binding set, setup, renderHeader, renderEmptyState"
    - "serverPlugin is a minimal ServerPlugin exporting id='site-editor' with an empty routes function"
    - "Plugin shell compiles without TypeScript errors (bun run check)"
  artifacts:
    - path: "packages/mesh-plugin-site-editor/package.json"
      provides: "Package manifest with workspace deps, client/server exports"
    - path: "packages/mesh-plugin-site-editor/shared.ts"
      provides: "PLUGIN_ID and PLUGIN_DESCRIPTION constants"
    - path: "packages/mesh-plugin-site-editor/client/index.tsx"
      provides: "clientPlugin export with DECO_BLOCKS_BINDING, setup, renderHeader, renderEmptyState"
    - path: "packages/mesh-plugin-site-editor/server/index.ts"
      provides: "serverPlugin export (stub — extended in plan 17-06)"
  key_links:
    - from: "packages/mesh-plugin-site-editor/client/index.tsx"
      to: "packages/bindings/src/well-known/deco-blocks.ts"
      via: "import { DECO_BLOCKS_BINDING } from '@decocms/bindings'"
      pattern: "DECO_BLOCKS_BINDING"
    - from: "packages/mesh-plugin-site-editor/client/index.tsx"
      to: "packages/bindings/src/core/plugins.ts"
      via: "ClientPlugin<typeof DECO_BLOCKS_BINDING>"
      pattern: "ClientPlugin"
---

<objective>
Scaffold the mesh-plugin-site-editor package with its client and server entry points, plugin shell, and plugin header/empty-state components. This is the foundation all other plans in this phase depend on.

Purpose: Establish the package structure, binding wiring, and plugin registration shape so subsequent plans can add routes and UI without touching the scaffold.
Output: packages/mesh-plugin-site-editor/ with package.json, tsconfig.json, shared.ts, client/index.tsx, client/components/plugin-header.tsx, client/components/plugin-empty-state.tsx, server/index.ts
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-site-editor-plugin/17-CONTEXT.md
@.planning/phases/17-site-editor-plugin/17-RESEARCH.md

Reference plugin for structure: @packages/mesh-plugin-workflows/package.json
Reference plugin for client index: @packages/mesh-plugin-object-storage/index.tsx
Reference binding: @packages/bindings/src/well-known/deco-blocks.ts
Plugin types: @packages/bindings/src/core/plugins.ts
Server plugin types: @packages/bindings/src/core/server-plugin.ts
Plugin registration: @apps/mesh/src/web/plugins.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold package.json, tsconfig.json, shared.ts</name>
  <files>
    packages/mesh-plugin-site-editor/package.json
    packages/mesh-plugin-site-editor/tsconfig.json
    packages/mesh-plugin-site-editor/shared.ts
  </files>
  <action>
Create packages/mesh-plugin-site-editor/ directory structure.

**package.json** — model after packages/mesh-plugin-workflows/package.json:
```json
{
  "name": "mesh-plugin-site-editor",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "description": "Visual site editor plugin for Deco sites in Mesh",
  "scripts": {
    "check": "tsc --noEmit",
    "test": "bun test"
  },
  "exports": {
    "./client": "./client/index.tsx",
    "./server": "./server/index.ts"
  },
  "dependencies": {
    "@decocms/bindings": "workspace:*",
    "@decocms/mesh-sdk": "workspace:*",
    "@decocms/mesh-plugin-deco-blocks": "workspace:*",
    "@deco/ui": "workspace:*",
    "@dnd-kit/core": "^6.1.0",
    "@dnd-kit/sortable": "^8.0.0",
    "@dnd-kit/modifiers": "^7.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@rjsf/core": "^6.1.2",
    "@rjsf/utils": "^6.1.2",
    "@rjsf/validator-ajv8": "^6.1.2",
    "@untitledui/icons": "^0.0.19",
    "lucide-react": "^0.468.0",
    "nanoid": "^5.0.0",
    "sonner": "^2.0.0"
  },
  "peerDependencies": {
    "@tanstack/react-query": ">=5.0.0",
    "react": "^19.2.0"
  }
}
```

Note: @dnd-kit/* packages are already resolved in the monorepo workspace (found in node_modules/.bun/). @rjsf/* already in apps/mesh/package.json. Adding them as peer deps in apps/mesh is NOT required since this plugin's package.json declares them as direct dependencies.

**tsconfig.json** — minimal, extends closest root:
```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strict": true,
    "jsx": "react-jsx",
    "moduleResolution": "bundler",
    "noEmit": true
  },
  "include": ["**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

**shared.ts**:
```typescript
/**
 * Site Editor Plugin - Shared Constants
 *
 * Safe for importing in both server and client bundles.
 */

export const PLUGIN_ID = "site-editor";
export const PLUGIN_DESCRIPTION = "Visual composer for Deco sites";
```
  </action>
  <verify>
    File exists: packages/mesh-plugin-site-editor/package.json
    File exists: packages/mesh-plugin-site-editor/shared.ts
    shared.ts exports PLUGIN_ID and PLUGIN_DESCRIPTION
  </verify>
  <done>Package manifest, tsconfig, and shared constants exist with correct content</done>
</task>

<task type="auto">
  <name>Task 2: Create client plugin entry, plugin header, and plugin empty state; create server plugin stub</name>
  <files>
    packages/mesh-plugin-site-editor/client/index.tsx
    packages/mesh-plugin-site-editor/client/components/plugin-header.tsx
    packages/mesh-plugin-site-editor/client/components/plugin-empty-state.tsx
    packages/mesh-plugin-site-editor/server/index.ts
  </files>
  <action>
**client/components/plugin-header.tsx** — connection selector header, model after packages/mesh-plugin-object-storage/components/plugin-header.tsx (read it for exact pattern):
- Receives `PluginRenderHeaderProps` (connections, selectedConnectionId, onConnectionChange)
- Shows a simple "Site Editor" title with connection name
- Uses `@deco/ui/components/select` or a simple `<span>` for single-connection display (per plugin-layout.tsx, header only shows the configured connection read-only, onConnectionChange is a no-op)

**client/components/plugin-empty-state.tsx** — empty state for when no DECO_BLOCKS_BINDING connection:
- Imports `usePluginContext` from `@decocms/mesh-sdk/plugins` with `{ partial: true }`
- Shows message: "No Deco site connected" with a sub-message "This plugin activates when the project connection implements DECO_BLOCKS_BINDING (BLOCKS_LIST + LOADERS_LIST tools)."
- Uses `@deco/ui` components for layout

**client/index.tsx** — ClientPlugin definition:
```typescript
import { DECO_BLOCKS_BINDING } from "@decocms/bindings";
import type { ClientPlugin, PluginSetupContext } from "@decocms/bindings/plugins";
import { createPluginRouter } from "@decocms/bindings/plugins";
import { lazy } from "react";
import { LayoutAlt03 } from "@untitledui/icons";
import { PLUGIN_ID, PLUGIN_DESCRIPTION } from "../shared";
import { siteEditorRouter } from "./lib/router";

const PluginHeader = lazy(() => import("./components/plugin-header"));
const PluginEmptyState = lazy(() => import("./components/plugin-empty-state"));

export const clientPlugin: ClientPlugin<typeof DECO_BLOCKS_BINDING> = {
  id: PLUGIN_ID,
  description: PLUGIN_DESCRIPTION,
  binding: DECO_BLOCKS_BINDING,
  renderHeader: (props) => <PluginHeader {...props} />,
  renderEmptyState: () => <PluginEmptyState />,
  setup: (context: PluginSetupContext) => {
    context.registerRootSidebarItem({
      icon: <LayoutAlt03 size={16} />,
      label: "Site Editor",
    });
    // Routes registered here in plan 17-04 when router exists
    // For now: register empty route list to avoid setup error
    context.registerPluginRoutes([]);
  },
};
```

NOTE: `siteEditorRouter` does not exist yet — the setup function must register empty routes in this plan. The import will be added when plan 17-04 creates the router. For now, `client/lib/router.ts` is NOT needed — just register empty routes directly in setup to keep plan 01 self-contained and compilable.

Revised client/index.tsx (no router import yet):
```typescript
import { DECO_BLOCKS_BINDING } from "@decocms/bindings";
import type { ClientPlugin, PluginSetupContext } from "@decocms/bindings/plugins";
import { lazy } from "react";
import { LayoutAlt03 } from "@untitledui/icons";
import { PLUGIN_ID, PLUGIN_DESCRIPTION } from "../shared";

const PluginHeader = lazy(() => import("./components/plugin-header"));
const PluginEmptyState = lazy(() => import("./components/plugin-empty-state"));

export const clientPlugin: ClientPlugin<typeof DECO_BLOCKS_BINDING> = {
  id: PLUGIN_ID,
  description: PLUGIN_DESCRIPTION,
  binding: DECO_BLOCKS_BINDING,
  renderHeader: (props) => <PluginHeader {...props} />,
  renderEmptyState: () => <PluginEmptyState />,
  setup: (context: PluginSetupContext) => {
    context.registerRootSidebarItem({
      icon: <LayoutAlt03 size={16} />,
      label: "Site Editor",
    });
    context.registerPluginRoutes([]);
  },
};
```

**server/index.ts** — minimal ServerPlugin stub:
```typescript
import type { ServerPlugin } from "@decocms/bindings/server-plugin";
import { PLUGIN_ID, PLUGIN_DESCRIPTION } from "../shared";

export const serverPlugin: ServerPlugin = {
  id: PLUGIN_ID,
  description: PLUGIN_DESCRIPTION,
  routes: (_app, _ctx) => {
    // commit-message route added in plan 17-06
  },
};
```

After creating all files, run `bun run check` from packages/mesh-plugin-site-editor/ to verify TypeScript compiles. Fix any type errors before proceeding. Common issues:
- Missing @types/react — add to dependencies if needed
- LayoutAlt03 icon import path — check @untitledui/icons exports or use lucide-react Layout icon as fallback
  </action>
  <verify>
    cd /Users/guilherme/Projects/mesh && bun run --cwd=packages/mesh-plugin-site-editor check 2>&1 | tail -5
    Expect: "Found 0 errors" or exit 0
  </verify>
  <done>client/index.tsx exports clientPlugin with DECO_BLOCKS_BINDING; server/index.ts exports serverPlugin; TypeScript compiles cleanly</done>
</task>

</tasks>

<verification>
1. Run: `bun run --cwd=packages/mesh-plugin-site-editor check` — expect 0 errors
2. Confirm: clientPlugin.binding === DECO_BLOCKS_BINDING (contains BLOCKS_LIST + LOADERS_LIST)
3. Confirm: clientPlugin.id === "site-editor"
4. Confirm: serverPlugin.id === "site-editor"
5. Confirm: package.json exports "./client" and "./server"
6. Run: `bun run fmt` to ensure formatting passes
</verification>

<success_criteria>
- packages/mesh-plugin-site-editor/ exists as a valid TypeScript package
- TypeScript check passes with 0 errors
- ClientPlugin correctly typed with DECO_BLOCKS_BINDING — binding-filtered plugin activation is set up
- Package is ready for plans 17-02 through 17-06 to add data layer, routes, and UI
</success_criteria>

<output>
After completion, create `.planning/phases/17-site-editor-plugin/17-01-SUMMARY.md`
</output>
