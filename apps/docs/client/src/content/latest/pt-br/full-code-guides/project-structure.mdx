---
title: Estrutura do Projeto
description: Arquitetura TypeScript full-stack de monorepo
icon: Folder
---

import Callout from "../../../components/ui/Callout.astro";

Apps deco CMS são monorepos TypeScript full-stack. Backend e frontend compartilham tipos, são implantados juntos e comunicam via RPC tipado, sem necessidade de REST APIs.

<Callout type="success">
  **Um codebase, um deploy:** Mudanças no backend instantaneamente disponíveis no frontend com total type safety.
</Callout>

## Estrutura de Diretórios

```
my-ai-app/
├── package.json          # Scripts do workspace raiz (dev, gen, deploy)
├── tsconfig.json         # Configuração TypeScript compartilhada
│
├── server/               # Backend: Servidor MCP (Cloudflare Worker)
│   ├── main.ts          # Ponto de entrada do servidor
│   ├── deco.gen.ts      # Tipos auto-gerados (nunca edite)
│   │
│   ├── tools/           # Definições de tools por domínio
│   │   ├── index.ts     # Export central para todos os tools
│   │   ├── todos.ts     # Exemplo: Tools CRUD de tarefas
│   │   └── user.ts      # Exemplo: Tools de gerenciamento de usuário
│   │
│   ├── schema.ts        # Schema do banco de dados (Drizzle ORM + SQLite)
│   ├── db.ts            # Helper de conexão do banco de dados
│   ├── drizzle.config.ts # Configuração Drizzle
│   ├── drizzle/         # Arquivos de migração do banco de dados
│   └── wrangler.toml    # Config Cloudflare Workers
│
└── view/                # Frontend: App React (Vite + TanStack Router)
    ├── src/
    │   ├── main.tsx     # Ponto de entrada do app com router
    │   │
    │   ├── routes/      # Componentes de página (TanStack Router)
    │   │   └── home.tsx # Exemplo: Rota da homepage
    │   │
    │   ├── components/  # Componentes UI reutilizáveis
    │   │   ├── ui/      # Sistema de design shadcn/ui
    │   │   └── ...      # Componentes customizados
    │   │
    │   ├── hooks/       # Hooks React customizados
    │   │   └── useToolCalls.ts # Exemplo: Wrapper de chamada de tool
    │   │
    │   ├── lib/         # Utilitários principais
    │   │   ├── rpc.ts   # Cliente RPC tipado (chama backend)
    │   │   └── utils.ts # Utilitários gerais
    │   │
    │   └── styles.css   # Estilos Tailwind CSS
    │
    ├── public/          # Assets estáticos (imagens, fontes)
    ├── vite.config.ts   # Configuração do bundler Vite
    ├── components.json  # Configuração shadcn/ui
    └── package.json     # Dependências do frontend
```

## Fluxo de Desenvolvimento

1. Defina tool em `server/tools/`
2. Execute `npm run gen:self` para gerar tipos
3. Chame `client.tools.SEU_TOOL(...)` do React
4. TypeScript força correção em compile time

Sem REST APIs, sem incompatibilidades de versão, sem código de integração.

## Backend (`/server`)

Seu Cloudflare Worker serve:
- **`/mcp`** - Servidor MCP para agents de IA
- **`/rpc`** - RPC tipado para sua UI React  
- **`/`** - Assets estáticos (app React buildado)

### `main.ts`

```typescript
import { withRuntime } from "@deco/workers-runtime";
import { StateSchema } from "./deco.gen.ts";
import { tools } from "./tools/";
import { workflows } from "./workflows/";
import { views } from "./views";

const runtime = withRuntime<Env, typeof StateSchema>({
  oauth: {
    scopes: ["AI_GENERATE", "AI_GENERATE_OBJECT"],
    state: StateSchema,
  },
  tools,
  workflows,
  views,
  fetch: fallbackToView("/"), // Serve assets React
});

export const Workflow = runtime.Workflow;
export default runtime;
```

**OAuth Scopes:** Solicite permissões para capacidades de geração de IA.

**State Schema:** Formulário de configuração que usuários preenchem ao instalar seu app. Estenda com campos customizados para API keys, configurações de ambiente, etc.

### `tools/`

Organize tools por domínio:

```
tools/
├── index.ts        # Exporta todos os tools
├── customers.ts    # Tools relacionados a clientes
└── billing.ts      # Tools relacionados a cobrança
```

```typescript
// tools/index.ts
export { customerTools } from "./customers";
export { billingTools } from "./billing";

export const tools = [
  ...customerTools,
  ...billingTools,
];
```

Veja [Criando Tools](/pt-br/full-code-guides/building-tools) para detalhes.

### `workflows/`

Organize workflows por domínio:

```typescript
// workflows/index.ts
export const workflows = [
  // Adicione criadores de workflow aqui
];
```

### `views.ts`

Apps React externos que integram com seu MCP:

```typescript
export const views = () => [
  {
    title: "Meu App",
    icon: "dashboard",
    url: "https://meu-app.deco.page",
  },
];
```

### `deco.gen.ts`

Tipos auto-gerados. Nunca edite manualmente.

```bash
npm run gen        # Regenere após adicionar integrações
npm run gen:self   # Gere tipos para seus tools
```

### `schema.ts and db.ts`

Schema do banco de dados (Drizzle ORM + SQLite):

```typescript
// schema.ts
export const customers = sqliteTable("customers", {
  id: integer("id").primaryKey(),
  name: text("name"),
  email: text("email"),
});

// db.ts
export const getDb = (env: Env) => getDatabase(env, schema);
```

### `wrangler.toml`

Configuração do Cloudflare Workers. Auto-atualizado ao adicionar integrações.

## Frontend (`/view`)

React 19 + Tailwind v4 + TanStack Router.

```
view/src/
├── main.tsx         # Ponto de entrada
├── routes/          # Páginas  
├── components/ui/   # Componentes UI
├── lib/rpc.ts       # Cliente RPC tipado
└── styles.css       # Estilos Tailwind
```

### Cliente RPC

O cliente `rpc.ts` é auto-gerado dos seus tools do backend:

```typescript
// view/src/lib/rpc.ts
import { createClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

export const client = createClient<Env["SELF"]>();
```

Uso no React:

```typescript
import { client } from "./lib/rpc";

const result = await client.tools.EMAIL_SEND({
  to: "user@example.com",
  subject: "Bem-vindo",
  body: "Obrigado por se inscrever",
});
```

TypeScript fornece autocomplete e verificação de tipos para todos inputs/outputs de tools.

Veja [Construindo Views](/pt-br/full-code-guides/building-views) para detalhes.

