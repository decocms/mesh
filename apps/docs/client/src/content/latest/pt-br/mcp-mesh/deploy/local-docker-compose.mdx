---
title: "Local: Docker Compose"
description: Deploy do MCP Mesh localmente usando Docker Compose para testes e desenvolvimento
icon: Container
---

import Callout from "../../../../components/ui/Callout.astro";

Este guia cobre o deploy do MCP Mesh localmente usando Docker Compose para testes rápidos e desenvolvimento.

Saiba mais: [página do MCP Mesh](https://www.decocms.com/mesh)

Código-fonte (Docker Compose + README): [decocms/mesh/deploy](https://github.com/decocms/mesh/tree/main/deploy)

## Visão Geral

- ✅ **SQLite por padrão** - Funciona imediatamente sem configuração adicional
- ✅ **PostgreSQL opcional** - Configure via variável de ambiente
- ✅ **Persistência de dados** - Volume Docker para manter dados entre reinicializações
- ✅ **Health checks** - Monitoramento automático de saúde da aplicação
- ✅ **Configuração via variáveis** - Todas as configurações via `.env`

## Pré-requisitos

- Docker 20.10+
- Docker Compose 2.0+
- (Opcional) PostgreSQL se quiser usar banco de dados externo

## Início Rápido

A maneira mais rápida de testar a aplicação:

```bash
# 1. Configure variáveis de ambiente
# Edite .env e configure BETTER_AUTH_SECRET (obrigatório)
# Gere um secret: openssl rand -base64 32
cp conf-examples/env.example .env

# 2. Configure autenticação
cp conf-examples/auth-config.json.example auth-config.json

# 3. Inicie a aplicação
docker compose up -d

# 4. Acesse
open http://localhost:3000
```

<Callout type="tip">
  Essas configurações são tudo que você precisa para começar a testar com o MCP-MESH. Se precisar de outras opções, confira as seções abaixo.
</Callout>

### Configuração Mínima

O arquivo `.env` precisa pelo menos:

```bash
BETTER_AUTH_SECRET=seu_secret_gerado_aqui
```

Todas as outras variáveis têm valores padrão que funcionam para testes locais.

## Configuração

### Variáveis de Ambiente

O arquivo `.env` contém todas as configurações.

| Variável | Padrão | Descrição |
|----------|--------|-----------|
| `IMAGE_REPOSITORY` | `ghcr.io/decocms/mesh/mesh` | Repositório da imagem |
| `IMAGE_TAG` | `latest` | Tag da imagem |
| `PORT` | `3000` | Porta exposta no host |
| `NODE_ENV` | `production` | Ambiente Node.js |
| `BETTER_AUTH_URL` | `http://localhost:3000` | URL para autenticação |
| `BASE_URL` | `http://localhost:3000` | URL base da aplicação |
| `BETTER_AUTH_SECRET` | **obrigatório** | Secret de autenticação |
| `DATABASE_URL` | `/app/data/mesh.db` | URL do banco de dados (SQLite ou PostgreSQL) |

## Usando SQLite (Padrão)

SQLite é o padrão e não requer configuração adicional:

```bash
# .env
DATABASE_URL=/app/data/mesh.db
```

Os dados serão persistidos no volume Docker `mesh-data` e mantidos entre reinicializações.

**Vantagens:**
- ✅ Zero configuração
- ✅ Funciona imediatamente
- ✅ Ideal para desenvolvimento e testes

**Limitações:**
- ⚠️ Apenas 1 instância (não escalável horizontalmente)
- ⚠️ Performance limitada para grandes volumes de dados

## Usando PostgreSQL

Para usar PostgreSQL, você tem duas opções:

### Opção 1: Usar docker-compose.postgres.yml (Recomendado)

Já existe um arquivo `docker-compose.postgres.yml` pronto para uso.

Configure no `.env`:

```bash
POSTGRES_USER=mesh_user
POSTGRES_PASSWORD=senha_segura_aqui
POSTGRES_DB=mesh_db
```

Inicie com PostgreSQL incluído:

```bash
docker compose -f docker-compose.postgres.yml up -d
```

A `DATABASE_URL` será configurada automaticamente, mas você pode especificar se necessário:

```bash
DATABASE_URL=postgresql://mesh_user:senha_segura_aqui@postgres:5432/mesh_db
```

### Opção 2: PostgreSQL Externo

Se você já tem um PostgreSQL rodando (local ou remoto):

```bash
# .env
DATABASE_URL=postgresql://usuario:senha@host:5432/nome_do_banco
```

**Exemplo com PostgreSQL local:**

```bash
DATABASE_URL=postgresql://postgres:senha@host.docker.internal:5432/mesh_db
```

**Exemplo com PostgreSQL remoto:**

```bash
DATABASE_URL=postgresql://usuario:senha@db.exemplo.com:5432/mesh_db
```

<Callout type="info">
  **Nota:** `localhost` dentro do container aponta para o próprio container.

  - Se você estiver usando o PostgreSQL incluído no `docker-compose.postgres.yml`, o host deve ser o nome do service: `postgres`.
  - Se você estiver conectando a um PostgreSQL rodando na sua máquina, use `host.docker.internal` (Docker Desktop) ou o IP da sua máquina na rede.
</Callout>

**Vantagens do PostgreSQL:**
- ✅ Suporta múltiplas instâncias (escalabilidade horizontal)
- ✅ Melhor performance para grandes volumes
- ✅ Recursos avançados (backups, replicação, etc.)

## Configuração de Autenticação

### Localização no Container

O arquivo `auth-config.json` é montado no caminho:

```
/app/apps/mesh/auth-config.json
```

### Como Funciona no Docker Compose

#### Arquivo Local

O arquivo `auth-config.json` deve existir na pasta raiz, junto com o docker-compose para iniciar a stack:

```yaml
volumes:
  - ./auth-config.json:/app/apps/mesh/auth-config.json:ro
```

#### Montagem no Container

- **Origem**: `./auth-config.json` (arquivo na raiz, junto com docker-compose)
- **Destino**: `/app/apps/mesh/auth-config.json` (dentro do container)
- **Modo**: `ro` (somente leitura)

#### Quando é Carregado

A aplicação Mesh carrega este arquivo na inicialização para configurar:

- Autenticação por Email/Senha
- Provedores sociais (Google, GitHub)
- Provedores SAML
- Provedores de email (Resend, etc.)
- Configuração de magic link

### Arquivos de Exemplo Disponíveis

Existem dois arquivos de exemplo na pasta `conf-examples/`:

#### Configuração Simples

Use este arquivo quando precisar apenas de autenticação básica por email e senha:

```json
{
  "emailAndPassword": {
    "enabled": true
  }
}
```

**Quando usar:**
- Apenas autenticação por email/senha
- Não precisa de SSO ou login social
- Não precisa enviar emails (convites, magic links, etc.)

#### Configuração Completa (SSO + Email)

Use este arquivo quando precisar de recursos avançados como SSO, login social e envio de emails:

```json
{
  "emailAndPassword": {
    "enabled": true
  },
  "socialProviders": {
    "google": {
      "clientId": "",
      "clientSecret": ""
    },
    "github": {
      "clientId": "",
      "clientSecret": ""
    }
  },
  "saml": {
    "enabled": false,
    "providers": []
  },
  "emailProviders": [
    {
      "id": "resend-primary",
      "provider": "resend",
      "config": {
        "apiKey": "",
        "fromEmail": "noreply@exemplo.com"
      }
    }
  ],
  "inviteEmailProviderId": "resend-primary",
  "magicLinkConfig": {
    "enabled": true,
    "emailProviderId": "resend-primary"
  }
}
```

**Quando usar:**
- Precisa de SSO (SAML)
- Precisa de login social (Google, GitHub)
- Precisa enviar emails (convites, magic links, etc.)
- Precisa de magic links para autenticação sem senha

### Estrutura de Referência Completa

A estrutura completa do arquivo `auth-config.json` inclui:

- **emailAndPassword**: Autenticação básica por email/senha
- **socialProviders**: Provedores sociais (Google, GitHub)
- **saml**: Configuração SAML para SSO empresarial
- **emailProviders**: Configuração de provedores de email (Resend, etc.)
- **inviteEmailProviderId**: ID do provedor de email para envio de convites
- **magicLinkConfig**: Configuração de magic link (autenticação via link enviado por email)

### Como Editar

1. **Edite o arquivo localmente**:

```bash
# Abra seu editor de arquivo e faça edições
vim auth-config.json
```

2. **Reinicie o container** para carregar as alterações:

```bash
docker compose restart mesh
```

3. **Ou recrie o container**:

```bash
docker compose up -d --force-recreate mesh
```

<Callout type="warning">
  O arquivo deve ser JSON válido. Se o arquivo não existir, o Docker Compose falhará ao iniciar. Não commite secrets (clientSecret, apiKey) no arquivo em produção.
</Callout>

## Segurança

### Gerar BETTER_AUTH_SECRET

<Callout type="warning">
  Sempre gere um secret seguro em produção!
</Callout>

```bash
# Gere um secret seguro (32+ caracteres)
openssl rand -base64 32

# Adicione ao .env
BETTER_AUTH_SECRET=seu_secret_gerado_aqui
```

### Proteger arquivo .env

```bash
# Não commite .env no Git
echo ".env" >> .gitignore

# Defina permissões restritivas
chmod 600 .env
```

## Monitoramento

### Logs

```bash
# Ver logs em tempo real
docker compose logs -f mesh

# Ver últimas 100 linhas
docker compose logs --tail=100 mesh

# Ver logs desde um timestamp
docker compose logs --since 2024-01-01T00:00:00 mesh
```

### Status do Container

```bash
# Ver status
docker compose ps

# Ver detalhes
docker compose ps -a

# Ver uso de recursos
docker stats deco-mcp-mesh
```

### Resetar Volume (Deletar Dados)

Para resetar completamente os dados e começar do zero:

#### Método 1: Usar Docker Compose (Recomendado)

```bash
# Parar containers e remover volumes
docker compose down -v

# Reiniciar com volume vazio
docker compose up -d
```

A flag `-v` remove os volumes nomeados definidos no `docker-compose.yml`.

#### Método 2: Resetar volume específico

```bash
# Parar apenas o serviço
docker compose stop mesh

# Remover volume específico
docker volume rm docker_mesh-data

# Ou se estiver em outro diretório:
docker volume rm helm-chart-deco-mcp-mesh_mesh-data

# Reiniciar (criará novo volume vazio)
docker compose up -d
```

#### Método 3: Backup antes de resetar

```bash
# 1. Faça backup primeiro
docker compose exec mesh cp /app/data/mesh.db /app/data/mesh.db.backup
docker compose cp mesh:/app/data/mesh.db ./backup-$(date +%Y%m%d-%H%M%S).db

# 2. Resete
docker compose down -v
docker compose up -d
```

#### Método 4: Resetar apenas SQLite (manter outros dados)

Se você quer resetar apenas o banco SQLite mantendo outros arquivos:

```bash
# Entre no container
docker compose exec mesh sh

# Dentro do container, remova apenas o banco
rm /app/data/mesh.db

# Reinicie a aplicação (recriará o banco)
exit
docker compose restart mesh
```

#### Verificar volumes

```bash
# Listar volumes
docker volume ls | grep mesh

# Ver detalhes do volume
docker volume inspect docker_mesh-data

# Ver tamanho usado
docker system df -v
```

<Callout type="warning">
  `docker compose down -v` **deleta permanentemente todos os dados**. Faça backup primeiro se tiver dados importantes. Volumes não são removidos automaticamente ao executar `docker compose down` (sem `-v`).
</Callout>

## Atualizando

### Atualizar Imagem

```bash
# Parar aplicação
docker compose down

# Atualizar imagem
docker compose pull

# Reiniciar
docker compose up -d
```

### Atualizar para versão específica

```bash
# Editar .env
IMAGE_TAG=0.1.24

# Atualizar
docker compose pull
docker compose up -d
```

## Backup e Restauração

### Backup (SQLite)

```bash
# Criar backup
docker compose exec mesh cp /app/data/mesh.db /app/data/mesh.db.backup

# Copiar para o host
docker compose cp mesh:/app/data/mesh.db ./backup-$(date +%Y%m%d).db
```

### Backup (PostgreSQL)

```bash
# Backup do banco
docker compose exec postgres pg_dump -U mesh_user mesh_db > backup-$(date +%Y%m%d).sql

# Restaurar
docker compose exec -T postgres psql -U mesh_user mesh_db < backup-20240101.sql
```


